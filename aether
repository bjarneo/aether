#!/bin/bash
cd "$(dirname "$0")" || exit

# If arguments are provided, run the CLI
# Otherwise, run the GUI application
if [ $# -gt 0 ]; then
    # Handle menu command in bash
    if [ "$1" == "menu" ]; then
        # Get the list of blueprints
        blueprints=$(./aether blue-prints 2>/dev/null)

        if [ -z "$blueprints" ]; then
            echo "No blueprints found"
            exit 1
        fi

        # Use Walker to show the menu (matching menu.sample style)
        if command -v omarchy-launch-walker &> /dev/null; then
            selected=$(echo -e "$blueprints" | omarchy-launch-walker --dmenu --width 295 --minheight 1 --maxheight 600 -p "Select blueprintâ€¦" 2>/dev/null)
        elif command -v walker &> /dev/null; then
            selected=$(echo -e "$blueprints" | walker --dmenu -p "Select blueprint..." 2>/dev/null)
        elif command -v rofi &> /dev/null; then
            selected=$(echo -e "$blueprints" | rofi -dmenu -p "Select blueprint...")
        elif command -v dmenu &> /dev/null; then
            selected=$(echo -e "$blueprints" | dmenu -i -l 10 -p "Select blueprint...")
        elif command -v fzf &> /dev/null; then
            selected=$(echo -e "$blueprints" | fzf --height=20%)
        else
            echo "No menu launcher found (walker/dmenu/rofi/fzf). Please install one of these tools."
            exit 1
        fi

        # If user selected something, apply it
        if [ -n "$selected" ]; then
            exec ./aether apply-blue-print "$selected"
        fi
        exit 0
    fi

    exec gjs -m src/cli/index.js "$@"
else
    exec gjs -m src/main.js
fi
